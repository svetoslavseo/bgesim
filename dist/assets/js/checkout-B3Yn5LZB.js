import{r as c,j as e}from"./react-vendor-4ojIaEMp.js";import{P as C}from"./components-UJEfX2Hl.js";import{u as E,g as b,f as I}from"./utils-CuaJlodt.js";import{F as P}from"./icons-B0Rijjdx.js";import{u as U}from"./i18n-CUQnsjz_.js";import"./vendor-B3hKfGQP.js";import"./constants-Ct2pKzgS.js";import"./articles-_cSwa24C.js";import"./country-page-B7zHV9K_.js";import"./data-service-CydxH5Qr.js";import"./plan-components-D5Z3gAVo.js";import"./compatibility-DDqLnYC0.js";const V=()=>{const{t:s,i18n:d}=U(["checkout","countries"]),{isChinese:i}=E(),j=(r,a={})=>s(r,{ns:"countries",...a}),w=r=>{if(!r)return"";if(d.language==="bg"){if(r.includes("7 days"))return"7 дни";if(r.includes("15 days"))return"15 дни";if(r.includes("30 days"))return"30 дни";if(r.includes("1 day"))return"1 ден";if(r.includes("days"))return r.replace("days","дни");if(r.includes("day"))return r.replace("day","ден")}return r},[o,N]=c.useState({country:"Austria",flag:"/esim-data/flags/at.svg",data:"1GB",validity:"7 days",price:3.99,currency:"$"}),[v,_]=c.useState(!0),[p,l]=c.useState(null),[B,x]=c.useState(!1),f=r=>{if(console.log("getTranslatedName called with:",r),console.log("Current language:",d.language),console.log("i18n ready:",d.isInitialized),!d.isInitialized)return console.log("i18n not ready, returning original name"),r;const a={"North America":"north-america","South America":"south-america",Europe:"europe",Asia:"asia",Africa:"africa",Oceania:"oceania"};if(a[r]){try{const n=a[r],t=s(`regions.${n}`,{ns:"countries"});if(console.log("Region translation attempt:",{name:r,regionId:n,result:t}),t&&t!==`regions.${n}`)return t}catch(n){console.error("Region translation error:",n)}return r}try{const n=j(r.toLowerCase().replace(/\s+/g,"-"));return console.log("Country translation attempt:",{name:r,key:r.toLowerCase().replace(/\s+/g,"-"),result:n}),n===r.toLowerCase().replace(/\s+/g,"-")?(console.log("Country translation failed, using original name"),r):n}catch(n){return console.error("Translation error:",n),r}};c.useEffect(()=>{(async()=>{const n=new URLSearchParams(window.location.search).get("plan");if(n)try{const t=JSON.parse(decodeURIComponent(n));if(t&&typeof t=="object"){if(typeof t.price=="object"&&t.price.amount_with_tax&&(t.price=t.price.amount_with_tax/100),console.log("DEBUG: decodedPlan in checkout:",t),console.log("DEBUG: decodedPlan.identifier:",t.identifier),console.log("DEBUG: decodedPlan.priceIdentifier:",t.priceIdentifier),!t.priceIdentifier&&t.identifier)try{const m=await fetch("/saily_plans.json");if(m.ok){const y=await m.json(),u=(Array.isArray(y?.items)?y.items:[]).find(k=>k?.identifier===t.identifier)?.price?.identifier;u?(console.log("DEBUG: Backfilled priceIdentifier from saily_plans.json:",u),t.priceIdentifier=u):console.warn("WARN: Could not backfill priceIdentifier for identifier:",t.identifier)}else console.warn("WARN: Failed to fetch saily_plans.json for backfill")}catch(m){console.error("Error backfilling priceIdentifier:",m)}N(t)}else l(s("errors.invalid_plan_data"))}catch(t){console.error("Error parsing plan data:",t),l(s("errors.unable_to_load_plan"))}else l(s("errors.no_plan_provided"));_(!1)})()},[]);const h=()=>{const r=o.priceIdentifier;if(!r){l(s("errors.no_plan_identifier"));return}try{console.log("DEBUG: plan in handleProceedToPayment:",o),console.log("DEBUG: plan.identifier (unused for checkout):",o.identifier),console.log("DEBUG: plan.priceIdentifier (used):",o.priceIdentifier),console.log("DEBUG: planIdForCheckout:",r);const a=i?`https://saily.com/zh/checkout/?planId=${r}&aff_transaction_id={transaction_id}&aff_offer_id={offer_id}&aff_id={aff_id}`:`https://saily.com/checkout/?planId=${r}&aff_transaction_id={transaction_id}&aff_offer_id={offer_id}&aff_id={aff_id}`,n=`https://go.saily.site/aff_c?offer_id=101&aff_id=8080&url=${encodeURIComponent(a)}`;console.log("DEBUG: sailyCheckoutUrl:",a),console.log("DEBUG: finalUrl:",n),window.location.href=n}catch(a){console.error("Error redirecting to payment:",a),l(s("errors.unable_to_proceed_payment"))}},g=(r,a)=>i?I(r,a):`${a}${r.toFixed(2)}`;return v?e.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center py-8 px-2",children:e.jsx("div",{className:"w-full max-w-xl bg-white rounded-2xl shadow-lg p-6 sm:p-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:s("loading.message")})]})})}):p?e.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center py-8 px-2",children:e.jsxs("div",{className:"w-full max-w-xl bg-white rounded-2xl shadow-lg p-6 sm:p-10",children:[e.jsxs("a",{href:i?"/zh":"/",className:"text-gray-500 text-sm mb-4 inline-block",children:["← ",s("navigation.back")]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12 mx-auto",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:s("error.title")}),e.jsx("p",{className:"text-gray-600 mb-6",children:p}),e.jsx("a",{href:i?"/zh":"/",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:s("error.return_home")})]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 py-8 pb-28 px-2",children:[e.jsxs("div",{className:"w-full max-w-xl mx-auto",children:[e.jsxs("a",{href:i?"/zh":"/",className:"text-gray-500 text-sm mb-4 inline-block",children:["← ",s("navigation.back")]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 sm:p-10",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:s("summary.title")}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[(()=>{const r=o.flag?.includes("/esim-data/flags/")?o.flag.split("/esim-data/flags/")[1]?.split(".")[0]?.toUpperCase():"GL",a=b(r,f(o.country),"w-12 h-12 rounded");return e.jsx("img",{...a,onError:()=>x(!0)})})(),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s("summary.esim_for",{country:f(o.country)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-600",children:[s("summary.data"),":"]}),e.jsx("span",{className:"ml-2 font-medium",children:o.data})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-600",children:[s("summary.validity"),":"]}),e.jsx("span",{className:"ml-2 font-medium",children:w(o.validity)})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-semibold text-gray-900",children:[s("summary.total"),":"]}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:g(o.price,o.currency)})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:s("payment.methods.title")}),e.jsx(C,{})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("span",{className:"text-sm text-blue-800",children:s("security.ssl_encrypted")})]})}),e.jsx("button",{onClick:h,className:"hidden",children:s("payment.continue")})]})]}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-gray-200 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/80",children:e.jsxs("div",{className:"max-w-xl mx-auto px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[(()=>{const r=o.flag?.includes("/esim-data/flags/")?o.flag.split("/esim-data/flags/")[1]?.split(".")[0]?.toUpperCase():"GL",a=b(r,f(o.country),"w-7 h-7 rounded");return e.jsx("img",{...a,onError:()=>x(!0)})})(),e.jsxs("span",{className:"text-gray-600",children:[s("summary.total"),":"]})]}),e.jsx("span",{className:"font-bold text-gray-900",children:g(o.price,o.currency)})]}),e.jsxs("button",{onClick:h,className:"group relative w-full bg-gradient-to-r from-yellow-400 via-yellow-300 to-yellow-400 text-black py-4 px-6 pr-12 rounded-xl font-bold hover:from-yellow-300 hover:via-yellow-200 hover:to-yellow-300 transform hover:scale-[1.02] transition-all duration-200 focus:outline-none focus:ring-3 focus:ring-yellow-500 focus:ring-offset-2 text-center shadow-lg hover:shadow-xl border-2 border-yellow-500/30",children:[e.jsx("span",{className:"pointer-events-none text-lg font-extrabold",children:s("payment.continue")}),e.jsx(P,{className:"absolute right-5 top-1/2 -translate-y-1/2 transform transition-all duration-200 group-hover:translate-x-1 group-hover:scale-110 text-black",size:22})]})]})})]})};export{V as default};
