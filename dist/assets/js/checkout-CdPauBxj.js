import{r as c,j as e}from"./react-vendor-4ojIaEMp.js";import{P as C}from"./components-CMngPZgK.js";import{u as E,f as I}from"./utils-D058XuHK.js";import{F as U}from"./icons-D6WOLjW3.js";import{u as P}from"./i18n-D5CLTClQ.js";import"./vendor-B3hKfGQP.js";import"./constants-Ct2pKzgS.js";import"./articles-Gp0QO9c5.js";import"./country-page-DCGwAzV4.js";import"./data-service-CydxH5Qr.js";import"./plan-components-CroQkvhV.js";import"./compatibility-BDfFj75k.js";const J=()=>{const{t:s,i18n:d}=P(["checkout","countries"]),{isChinese:i}=E(),y=(r,n={})=>s(r,{ns:"countries",...n}),b=r=>{if(!r)return"";if(d.language==="bg"){if(r.includes("7 days"))return"7 Ð´Ð½Ð¸";if(r.includes("15 days"))return"15 Ð´Ð½Ð¸";if(r.includes("30 days"))return"30 Ð´Ð½Ð¸";if(r.includes("1 day"))return"1 Ð´ÐµÐ½";if(r.includes("days"))return r.replace("days","Ð´Ð½Ð¸");if(r.includes("day"))return r.replace("day","Ð´ÐµÐ½")}return r},[o,j]=c.useState({country:"Austria",flag:"/esim-data/flags/at.svg",data:"1GB",validity:"7 days",price:3.99,currency:"$"}),[w,N]=c.useState(!0),[u,l]=c.useState(null),[v,_]=c.useState(!1),x=r=>{if(console.log("getTranslatedName called with:",r),console.log("Current language:",d.language),console.log("i18n ready:",d.isInitialized),!d.isInitialized)return console.log("i18n not ready, returning original name"),r;const n={"North America":"north-america","South America":"south-america",Europe:"europe",Asia:"asia",Africa:"africa",Oceania:"oceania"};if(n[r]){try{const a=n[r],t=s(`regions.${a}`,{ns:"countries"});if(console.log("Region translation attempt:",{name:r,regionId:a,result:t}),t&&t!==`regions.${a}`)return t}catch(a){console.error("Region translation error:",a)}return r}try{const a=y(r.toLowerCase().replace(/\s+/g,"-"));return console.log("Country translation attempt:",{name:r,key:r.toLowerCase().replace(/\s+/g,"-"),result:a}),a===r.toLowerCase().replace(/\s+/g,"-")?(console.log("Country translation failed, using original name"),r):a}catch(a){return console.error("Translation error:",a),r}};c.useEffect(()=>{(async()=>{const a=new URLSearchParams(window.location.search).get("plan");if(a)try{const t=JSON.parse(decodeURIComponent(a));if(t&&typeof t=="object"){if(typeof t.price=="object"&&t.price.amount_with_tax&&(t.price=t.price.amount_with_tax/100),console.log("DEBUG: decodedPlan in checkout:",t),console.log("DEBUG: decodedPlan.identifier:",t.identifier),console.log("DEBUG: decodedPlan.priceIdentifier:",t.priceIdentifier),!t.priceIdentifier&&t.identifier)try{const m=await fetch("/saily_plans.json");if(m.ok){const g=await m.json(),f=(Array.isArray(g?.items)?g.items:[]).find(k=>k?.identifier===t.identifier)?.price?.identifier;f?(console.log("DEBUG: Backfilled priceIdentifier from saily_plans.json:",f),t.priceIdentifier=f):console.warn("WARN: Could not backfill priceIdentifier for identifier:",t.identifier)}else console.warn("WARN: Failed to fetch saily_plans.json for backfill")}catch(m){console.error("Error backfilling priceIdentifier:",m)}j(t)}else l(s("errors.invalid_plan_data"))}catch(t){console.error("Error parsing plan data:",t),l(s("errors.unable_to_load_plan"))}else l(s("errors.no_plan_provided"));N(!1)})()},[]);const h=()=>{const r=o.priceIdentifier;if(!r){l(s("errors.no_plan_identifier"));return}try{console.log("DEBUG: plan in handleProceedToPayment:",o),console.log("DEBUG: plan.identifier (unused for checkout):",o.identifier),console.log("DEBUG: plan.priceIdentifier (used):",o.priceIdentifier),console.log("DEBUG: planIdForCheckout:",r);const n=i?`https://saily.com/zh/checkout/?planId=${r}&aff_transaction_id={transaction_id}&aff_offer_id={offer_id}&aff_id={aff_id}`:`https://saily.com/checkout/?planId=${r}&aff_transaction_id={transaction_id}&aff_offer_id={offer_id}&aff_id={aff_id}`,a=`https://go.saily.site/aff_c?offer_id=101&aff_id=8080&url=${encodeURIComponent(n)}`;console.log("DEBUG: sailyCheckoutUrl:",n),console.log("DEBUG: finalUrl:",a),window.location.href=a}catch(n){console.error("Error redirecting to payment:",n),l(s("errors.unable_to_proceed_payment"))}},p=(r,n)=>i?I(r,n):`${n}${r.toFixed(2)}`;return w?e.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center py-8 px-2",children:e.jsx("div",{className:"w-full max-w-xl bg-white rounded-2xl shadow-lg p-6 sm:p-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:s("loading.message")})]})})}):u?e.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center py-8 px-2",children:e.jsxs("div",{className:"w-full max-w-xl bg-white rounded-2xl shadow-lg p-6 sm:p-10",children:[e.jsxs("a",{href:i?"/zh":"/",className:"text-gray-500 text-sm mb-4 inline-block",children:["â† ",s("navigation.back")]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12 mx-auto",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:s("error.title")}),e.jsx("p",{className:"text-gray-600 mb-6",children:u}),e.jsx("a",{href:i?"/zh":"/",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:s("error.return_home")})]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 py-8 pb-28 px-2",children:[e.jsxs("div",{className:"w-full max-w-xl mx-auto",children:[e.jsxs("a",{href:i?"/zh":"/",className:"text-gray-500 text-sm mb-4 inline-block",children:["â† ",s("navigation.back")]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 sm:p-10",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:s("summary.title")}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[v?e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600 text-xs",children:"ðŸ³ï¸"})}):e.jsx("img",{src:o.flag,alt:`${x(o.country)} flag`,className:"w-8 h-8 rounded",onError:()=>_(!0)}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s("summary.esim_for",{country:x(o.country)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-600",children:[s("summary.data"),":"]}),e.jsx("span",{className:"ml-2 font-medium",children:o.data})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-gray-600",children:[s("summary.validity"),":"]}),e.jsx("span",{className:"ml-2 font-medium",children:b(o.validity)})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-lg font-semibold text-gray-900",children:[s("summary.total"),":"]}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:p(o.price,o.currency)})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:s("payment.methods.title")}),e.jsx(C,{})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("span",{className:"text-sm text-blue-800",children:s("security.ssl_encrypted")})]})}),e.jsx("button",{onClick:h,className:"hidden",children:s("payment.continue")})]})]}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-gray-200 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/80",children:e.jsxs("div",{className:"max-w-xl mx-auto px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("span",{className:"text-gray-600",children:[s("summary.total"),":"]}),e.jsx("span",{className:"font-bold text-gray-900",children:p(o.price,o.currency)})]}),e.jsxs("button",{onClick:h,className:"group relative w-full bg-gradient-to-r from-yellow-400 via-yellow-300 to-yellow-400 text-black py-4 px-6 pr-12 rounded-xl font-bold hover:from-yellow-300 hover:via-yellow-200 hover:to-yellow-300 transform hover:scale-[1.02] transition-all duration-200 focus:outline-none focus:ring-3 focus:ring-yellow-500 focus:ring-offset-2 text-center shadow-lg hover:shadow-xl border-2 border-yellow-500/30",children:[e.jsx("span",{className:"pointer-events-none text-lg font-extrabold",children:s("payment.continue")}),e.jsx(U,{className:"absolute right-5 top-1/2 -translate-y-1/2 transform transition-all duration-200 group-hover:translate-x-1 group-hover:scale-110 text-black",size:22})]})]})})]})};export{J as default};
