const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/vendor-B3hKfGQP.js","assets/js/react-vendor-4ojIaEMp.js"])))=>i.map(i=>d[i]);
import{_ as u}from"./country-page-B7zHV9K_.js";import{u as E}from"./i18n-CUQnsjz_.js";const d="https://travelesim.bg",P=(n,e)=>({"@context":"https://schema.org","@type":"Organization",name:n("organization.name","Travel eSIMple"),url:d,logo:`${d}/esim-data/travelesim-logo.png`,contactPoint:{"@type":"ContactPoint",url:"https://support.travelesim.bg/",contactType:n("organization.contact_type","Customer Support"),availableLanguage:e==="bg"?["Bulgarian","English"]:["English","Bulgarian"]},sameAs:["https://travelesim.dk/","https://travelesim.bg/","https://travelesim.ro/","https://www.facebook.com/people/Travelesimdk/61573068836051/","https://www.instagram.com/travelesim.dk/"]}),v=(n,e)=>({"@context":"https://schema.org","@type":"WebSite","@id":`${d}/#website`,url:d,name:n("organization.name","Travel eSIMple"),publisher:{"@id":`${d}/#organization`},inLanguage:e==="bg"?"bg":"en"}),O=(n,e,a,t,i,r,o)=>({"@context":"https://schema.org","@type":"WebPage","@id":`${a}/#webpage`,url:a,name:t,description:i,inLanguage:e==="bg"?"bg":"en",isPartOf:{"@id":`${d}/#website`},...r&&{about:{"@id":r}},primaryImageOfPage:{"@type":"ImageObject",url:`${d}/esim-data/travelesim-logo.png`},...o&&{breadcrumb:{"@id":o}}}),C=(n,e,a,t)=>({"@context":"https://schema.org","@type":"BreadcrumbList","@id":`${a}/#breadcrumb`,itemListElement:t.map((i,r)=>({"@type":"ListItem",position:r+1,name:i.name,item:i.item}))}),T=(n,e,a,t,i,r)=>({"@context":"https://schema.org","@type":"Product","@id":`${a}/#product`,name:t,description:i,brand:{"@type":"Brand",name:n("organization.name","Travel eSIMple")},category:n("product.category","eSIM Data Plan"),offers:r}),D=(n,e,a,t)=>({"@context":"https://schema.org","@type":"FAQPage","@id":`${a}/#faq`,mainEntity:t.map(i=>({"@type":"Question",name:i.question,acceptedAnswer:{"@type":"Answer",text:i.answer}}))}),M=(n,e,a,t,i,r,o,s)=>({"@context":"https://schema.org","@type":"Person","@id":`${a}/#person`,name:t,jobTitle:i,worksFor:{"@id":r},sameAs:o,image:{"@type":"ImageObject",url:s}}),N=(n,e,a,t,i="Place",r,o,s)=>({"@context":"https://schema.org","@type":i,"@id":`${a}/#${i.toLowerCase()}`,name:t,...r&&{alternateName:r},...o&&{sameAs:o},...s}),b=(n,e,a,t,i,r,o,s)=>({"@context":"https://schema.org","@type":"AggregateOffer","@id":`${a}/#aggregate-offer`,priceCurrency:t,lowPrice:i,highPrice:r,offerCount:o,offers:s.map(c=>({"@id":c}))}),_=(n,e="svg")=>n?`/esim-data/flags/${n.toLowerCase()}.${e}`:"/esim-data/flags/globe.svg",I=(n,e,a="w-10 h-auto rounded-md")=>({src:_(n),alt:`${e} flag`,className:a,loading:"lazy",onError:t=>{const i=t.target;i.src.includes("flagcdn.com")||(i.src=`https://flagcdn.com/w80/${n.toLowerCase()}.png`)},onLoad:t=>{const i=t.target;i.style.opacity="1"}});class p{constructor(){this.cronJob=null,this.isUpdating=!1}static getInstance(){return p.instance||(p.instance=new p),p.instance}async initialize(){if(console.log("üîß Initializing Saily API Service..."),typeof window>"u")try{const e=await this.getFileStatus(),a=await this.getMetadata();!e.exists||!a||a.status==="error"||e.lastModified&&Date.now()-e.lastModified.getTime()>10080*60*1e3?(console.log("üîÑ Running initial data update..."),await this.updatePlansData()):console.log("‚úÖ Plans data is up to date"),await this.startWeeklyUpdates()}catch(e){console.error("‚ùå Server-side initialization failed:",e)}else console.log("üåê Client-side initialization - server operations skipped");console.log("‚úÖ Saily API Service initialized successfully")}async getCurrentPlansData(){if(typeof window<"u"){const e=["/saily_plans.json","/data/saily_plans.json","/public/saily_plans.json"];for(const a of e)try{const t=await fetch(a,{cache:"no-store"});if(t.ok)return await t.json()}catch{}return null}try{const e=await u(()=>import("./vendor-B3hKfGQP.js").then(r=>r._),__vite__mapDeps([0,1])),t=(await u(()=>import("./vendor-B3hKfGQP.js").then(r=>r._),__vite__mapDeps([0,1]))).join(process.cwd(),"saily_plans.json"),i=await e.readFile(t,"utf-8");return JSON.parse(i)}catch(e){return console.error("‚ùå Error reading plans data:",e),null}}async getMetadata(){if(typeof window<"u")return null;try{const e=await u(()=>import("./vendor-B3hKfGQP.js").then(r=>r._),__vite__mapDeps([0,1])),t=(await u(()=>import("./vendor-B3hKfGQP.js").then(r=>r._),__vite__mapDeps([0,1]))).join(process.cwd(),"saily_metadata.json"),i=await e.readFile(t,"utf-8");return JSON.parse(i)}catch{return null}}async getFileStatus(){if(typeof window<"u")return{exists:!1};try{const e=await u(()=>import("./vendor-B3hKfGQP.js").then(r=>r._),__vite__mapDeps([0,1])),t=(await u(()=>import("./vendor-B3hKfGQP.js").then(r=>r._),__vite__mapDeps([0,1]))).join(process.cwd(),"saily_plans.json"),i=await e.stat(t);return{exists:!0,lastModified:i.mtime,size:i.size}}catch{return{exists:!1}}}async updatePlansData(){if(typeof window<"u")return console.log("‚ö†Ô∏è Plan updates can only be run on server side"),!1;if(this.isUpdating)return console.log("‚è≥ Update already in progress, skipping..."),!1;this.isUpdating=!0;try{console.log("üöÄ Starting Saily plans data update using Python script...");const{spawn:e}=await u(async()=>{const{spawn:a}=await import("./vendor-B3hKfGQP.js").then(t=>t._);return{spawn:a}},__vite__mapDeps([0,1]));return new Promise(a=>{const t=e("python3",["scripts/fetch-saily-data.py"],{stdio:"pipe",cwd:process.cwd()});let i="",r="";t.stdout.on("data",o=>{const s=o.toString();i+=s,console.log(s.trim())}),t.stderr.on("data",o=>{const s=o.toString();r+=s,console.error(s.trim())}),t.on("close",async o=>{this.isUpdating=!1,o===0?(console.log("‚úÖ Python script completed successfully!"),a(!0)):(console.error(`‚ùå Python script failed with exit code ${o}`),a(!1))}),t.on("error",async o=>{this.isUpdating=!1,console.error("‚ùå Failed to run Python script:",o.message),a(!1)})})}catch(e){const a=e instanceof Error?e.message:"Unknown error";return console.error("‚ùå Failed to update Saily plans data:",a),!1}finally{this.isUpdating=!1}}async startWeeklyUpdates(){if(typeof window<"u"){console.log("‚ö†Ô∏è Weekly updates can only be scheduled on server side");return}try{const e=await u(()=>import("./vendor-B3hKfGQP.js").then(a=>a.n),__vite__mapDeps([0,1]));if(this.cronJob){console.log("‚ö†Ô∏è Weekly updates are already scheduled");return}this.cronJob=e.schedule("0 2 * * 0",async()=>{console.log("‚è∞ Weekly scheduled update triggered"),await this.updatePlansData()},{timezone:"UTC"}),this.cronJob.start(),console.log("üìÖ Weekly updates scheduled for every Sunday at 2:00 AM UTC")}catch(e){console.error("‚ùå Failed to schedule weekly updates:",e)}}stopWeeklyUpdates(){this.cronJob&&(this.cronJob.stop(),this.cronJob=null,console.log("‚èπÔ∏è Weekly updates stopped"))}clearCache(){}}const y=p.getInstance(),m={AT:"Europe",BE:"Europe",BG:"Europe",HR:"Europe",CY:"Europe",CZ:"Europe",DK:"Europe",EE:"Europe",FI:"Europe",FR:"Europe",DE:"Europe",GR:"Europe",HU:"Europe",IS:"Europe",IE:"Europe",IT:"Europe",LV:"Europe",LI:"Europe",LT:"Europe",LU:"Europe",MT:"Europe",NL:"Europe",NO:"Europe",PL:"Europe",PT:"Europe",RO:"Europe",SK:"Europe",SI:"Europe",ES:"Europe",SE:"Europe",CH:"Europe",GB:"Europe",UK:"Europe",VA:"Europe",AD:"Europe",MC:"Europe",SM:"Europe",ME:"Europe",RS:"Europe",BA:"Europe",MK:"Europe",AL:"Europe",MD:"Europe",UA:"Europe",BY:"Europe",RU:"Europe",CN:"Asia",JP:"Asia",KR:"Asia",IN:"Asia",TH:"Asia",VN:"Asia",SG:"Asia",MY:"Asia",ID:"Asia",PH:"Asia",TW:"Asia",HK:"Asia",MO:"Asia",KH:"Asia",LA:"Asia",MM:"Asia",BD:"Asia",LK:"Asia",NP:"Asia",BT:"Asia",MV:"Asia",AF:"Asia",PK:"Asia",UZ:"Asia",KZ:"Asia",KG:"Asia",TJ:"Asia",TM:"Asia",MN:"Asia",AM:"Asia",AZ:"Asia",GE:"Asia",TR:"Asia",IL:"Asia",PS:"Asia",JO:"Asia",LB:"Asia",SY:"Asia",IQ:"Asia",IR:"Asia",SA:"Asia",YE:"Asia",OM:"Asia",AE:"Asia",QA:"Asia",BH:"Asia",KW:"Asia",US:"North America",CA:"North America",MX:"North America",GT:"North America",BZ:"North America",SV:"North America",HN:"North America",NI:"North America",CR:"North America",PA:"North America",BR:"South America",AR:"South America",CL:"South America",PE:"South America",CO:"South America",VE:"South America",EC:"South America",BO:"South America",PY:"South America",UY:"South America",GY:"South America",SR:"South America",GF:"South America",ZA:"Africa",EG:"Africa",NG:"Africa",KE:"Africa",GH:"Africa",ET:"Africa",TZ:"Africa",UG:"Africa",MZ:"Africa",MG:"Africa",CM:"Africa",CI:"Africa",NE:"Africa",BF:"Africa",ML:"Africa",MW:"Africa",ZM:"Africa",SN:"Africa",SO:"Africa",TD:"Africa",GN:"Africa",RW:"Africa",BJ:"Africa",TN:"Africa",BI:"Africa",TG:"Africa",SL:"Africa",LY:"Africa",LR:"Africa",CF:"Africa",MR:"Africa",ER:"Africa",GM:"Africa",BW:"Africa",GA:"Africa",LS:"Africa",GW:"Africa",GQ:"Africa",MU:"Africa",SZ:"Africa",DJ:"Africa",KM:"Africa",CV:"Africa",ST:"Africa",SC:"Africa",MA:"Africa",DZ:"Africa",SD:"Africa",SS:"Africa",AO:"Africa",CD:"Africa",CG:"Africa",ZW:"Africa",NA:"Africa",AU:"Oceania",NZ:"Oceania",FJ:"Oceania",PG:"Oceania",NC:"Oceania",SB:"Oceania",VU:"Oceania",PF:"Oceania",WS:"Oceania",GU:"Oceania",TO:"Oceania",KI:"Oceania",PW:"Oceania",MH:"Oceania",FM:"Oceania",NR:"Oceania",TV:"Oceania",CK:"Oceania",NU:"Oceania",TK:"Oceania",WF:"Oceania",AS:"Oceania",MP:"Oceania"};class g{constructor(){this.cachedNormalizedPlans=null,this.lastCacheTime=0,this.CACHE_DURATION=300*1e3}static getInstance(){return g.instance||(g.instance=new g),g.instance}normalizeSailyPlan(e){const a=e.data_limit?.amount||0,t=e.data_limit?.unit||"GB",i=e.duration?.amount||0;let r="Global";if(e.covered_countries&&e.covered_countries.length>0)if(e.covered_countries.length===1)r=m[e.covered_countries[0]]||"Other";else if(e.covered_countries.length<=10){const h=e.covered_countries.map(l=>m[l]).filter(Boolean);if(h.length>0){const l={};h.forEach(f=>{l[f]=(l[f]||0)+1}),r=Object.keys(l).reduce((f,A)=>l[f]>l[A]?f:A)}}else r="Global";let o="country";return e.covered_countries&&e.covered_countries.length>10&&(o="regional"),e.covered_countries&&e.covered_countries.length>50&&(o="global"),{id:`saily-${e.covered_countries&&e.covered_countries.length===1?e.covered_countries[0].toLowerCase():"multi"}-${a}${t.toLowerCase()}-${i}d-${e.identifier.slice(-8)}`,identifier:e.identifier,name:e.name||`${a}${t} ${i} days`,data_amount:a,data_unit:t,data:`${a}${t}`,validity_days:i,validity:`${i} days`,price:{amount_with_tax:e.price?.amount_with_tax||0,currency:e.price?.currency||"USD",identifier:e.price?.identifier},covered_countries:e.covered_countries||[],region:r,planType:o,is_unlimited:e.is_unlimited||!1,source:"saily"}}async getNormalizedPlansData(){const e=Date.now();if(this.cachedNormalizedPlans&&e-this.lastCacheTime<this.CACHE_DURATION)return this.cachedNormalizedPlans;try{const{dataService:a}=await u(async()=>{const{dataService:s}=await import("./data-service-CydxH5Qr.js");return{dataService:s}},[]),t=await a.getPlansData(),i=await y.getCurrentPlansData(),r=[];t?.items&&t.items.forEach(s=>{r.push({...s,source:"local"})}),i?.items&&i.items.forEach(s=>{try{const c=this.normalizeSailyPlan(s);r.push(c)}catch(c){console.warn("Failed to normalize Saily plan:",s.identifier,c)}}),r.sort((s,c)=>{const h=s.covered_countries.length,l=c.covered_countries.length;return h===1&&l>1?-1:h>1&&l===1?1:s.price.amount_with_tax-c.price.amount_with_tax});const o={items:r};return this.cachedNormalizedPlans=o,this.lastCacheTime=e,console.log(`SailyPlansService: Normalized ${r.length} total plans (${t?.items?.length||0} local + ${i?.items?.length||0} Saily)`),o}catch(a){console.error("SailyPlansService: Failed to get normalized plans data:",a);try{const{dataService:t}=await u(async()=>{const{dataService:o}=await import("./data-service-CydxH5Qr.js");return{dataService:o}},[]),i=await t.getPlansData(),r=[];return i?.items&&i.items.forEach(o=>{r.push({...o,source:"local"})}),{items:r}}catch(t){return console.error("SailyPlansService: Fallback also failed:",t),{items:[]}}}}async getPlansForCountry(e){return(await this.getNormalizedPlansData()).items.filter(t=>t.covered_countries.includes(e.toUpperCase()))}async getPlansForRegion(e){const a=await this.getNormalizedPlansData(),i={europe:["Europe"],asia:["Asia"],"north-america":["North America"],"south-america":["South America"],africa:["Africa"],oceania:["Oceania"]}[e.toLowerCase()]||[e];return a.items.filter(r=>i.some(o=>r.region===o)||r.planType==="global"?!0:r.covered_countries&&r.covered_countries.length>0?r.covered_countries.some(o=>{const s=m[o];return i.includes(s)}):!1)}clearCache(){this.cachedNormalizedPlans=null,this.lastCacheTime=0}async getPlansStatistics(){const e=await this.getNormalizedPlansData(),a=e.items.filter(s=>s.source==="saily"),t=e.items.filter(s=>s.source==="local"),i=new Set;e.items.forEach(s=>{s.covered_countries.forEach(c=>i.add(c))});const r=e.items.reduce((s,c)=>s+c.price.amount_with_tax,0),o=e.items.length>0?r/e.items.length:0;return{totalPlans:e.items.length,sailyPlans:a.length,localPlans:t.length,countriesCovered:i.size,averagePrice:o/100}}}const L=g.getInstance(),R=(n,e="USD")=>e==="CNY"||e==="RMB"?`¬•${n.toFixed(2)}`:`$${n.toFixed(2)}`,U=()=>{const{i18n:n}=E();return{isChinese:n.language==="zh",currentLanguage:n.language}};export{d as B,_ as a,v as b,P as c,O as d,C as e,R as f,I as g,N as h,T as i,b as j,D as k,M as l,L as s,U as u};
