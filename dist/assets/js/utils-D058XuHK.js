const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/vendor-B3hKfGQP.js","assets/js/react-vendor-4ojIaEMp.js"])))=>i.map(i=>d[i]);
import{_ as u}from"./country-page-DCGwAzV4.js";import{u as _}from"./i18n-D5CLTClQ.js";const d="https://travelesim.bg",S=(n,e)=>({"@context":"https://schema.org","@type":"Organization",name:n("organization.name","Travel eSIMple"),url:d,logo:`${d}/esim-data/travelesim-logo.png`,contactPoint:{"@type":"ContactPoint",url:"https://support.travelesim.bg/",contactType:n("organization.contact_type","Customer Support"),availableLanguage:e==="bg"?["Bulgarian","English"]:["English","Bulgarian"]},sameAs:["https://travelesim.dk/","https://travelesim.bg/","https://travelesim.ro/","https://www.facebook.com/people/Travelesimdk/61573068836051/","https://www.instagram.com/travelesim.dk/"]}),P=(n,e)=>({"@context":"https://schema.org","@type":"WebSite","@id":`${d}/#website`,url:d,name:n("organization.name","Travel eSIMple"),publisher:{"@id":`${d}/#organization`},inLanguage:e==="bg"?"bg":"en"}),v=(n,e,i,a,r,t,o)=>({"@context":"https://schema.org","@type":"WebPage","@id":`${i}/#webpage`,url:i,name:a,description:r,inLanguage:e==="bg"?"bg":"en",isPartOf:{"@id":`${d}/#website`},...t&&{about:{"@id":t}},primaryImageOfPage:{"@type":"ImageObject",url:`${d}/esim-data/travelesim-logo.png`},...o&&{breadcrumb:{"@id":o}}}),O=(n,e,i,a)=>({"@context":"https://schema.org","@type":"BreadcrumbList","@id":`${i}/#breadcrumb`,itemListElement:a.map((r,t)=>({"@type":"ListItem",position:t+1,name:r.name,item:r.item}))}),C=(n,e,i,a,r,t)=>({"@context":"https://schema.org","@type":"Product","@id":`${i}/#product`,name:a,description:r,brand:{"@type":"Brand",name:n("organization.name","Travel eSIMple")},category:n("product.category","eSIM Data Plan"),offers:t}),T=(n,e,i,a)=>({"@context":"https://schema.org","@type":"FAQPage","@id":`${i}/#faq`,mainEntity:a.map(r=>({"@type":"Question",name:r.question,acceptedAnswer:{"@type":"Answer",text:r.answer}}))}),D=(n,e,i,a,r,t,o,s)=>({"@context":"https://schema.org","@type":"Person","@id":`${i}/#person`,name:a,jobTitle:r,worksFor:{"@id":t},sameAs:o,image:{"@type":"ImageObject",url:s}}),M=(n,e,i,a,r="Place",t,o,s)=>({"@context":"https://schema.org","@type":r,"@id":`${i}/#${r.toLowerCase()}`,name:a,...t&&{alternateName:t},...o&&{sameAs:o},...s}),N=(n,e,i,a,r,t,o,s)=>({"@context":"https://schema.org","@type":"AggregateOffer","@id":`${i}/#aggregate-offer`,priceCurrency:a,lowPrice:r,highPrice:t,offerCount:o,offers:s.map(c=>({"@id":c}))}),b=(n,e="svg")=>n?`/esim-data/flags/${n.toLowerCase()}.${e}`:"/esim-data/flags/globe.svg";class p{constructor(){this.cronJob=null,this.isUpdating=!1}static getInstance(){return p.instance||(p.instance=new p),p.instance}async initialize(){if(console.log("üîß Initializing Saily API Service..."),typeof window>"u")try{const e=await this.getFileStatus(),i=await this.getMetadata();!e.exists||!i||i.status==="error"||e.lastModified&&Date.now()-e.lastModified.getTime()>10080*60*1e3?(console.log("üîÑ Running initial data update..."),await this.updatePlansData()):console.log("‚úÖ Plans data is up to date"),await this.startWeeklyUpdates()}catch(e){console.error("‚ùå Server-side initialization failed:",e)}else console.log("üåê Client-side initialization - server operations skipped");console.log("‚úÖ Saily API Service initialized successfully")}async getCurrentPlansData(){if(typeof window<"u"){const e=["/saily_plans.json","/data/saily_plans.json","/public/saily_plans.json"];for(const i of e)try{const a=await fetch(i,{cache:"no-store"});if(a.ok)return await a.json()}catch{}return null}try{const e=await u(()=>import("./vendor-B3hKfGQP.js").then(t=>t._),__vite__mapDeps([0,1])),a=(await u(()=>import("./vendor-B3hKfGQP.js").then(t=>t._),__vite__mapDeps([0,1]))).join(process.cwd(),"saily_plans.json"),r=await e.readFile(a,"utf-8");return JSON.parse(r)}catch(e){return console.error("‚ùå Error reading plans data:",e),null}}async getMetadata(){if(typeof window<"u")return null;try{const e=await u(()=>import("./vendor-B3hKfGQP.js").then(t=>t._),__vite__mapDeps([0,1])),a=(await u(()=>import("./vendor-B3hKfGQP.js").then(t=>t._),__vite__mapDeps([0,1]))).join(process.cwd(),"saily_metadata.json"),r=await e.readFile(a,"utf-8");return JSON.parse(r)}catch{return null}}async getFileStatus(){if(typeof window<"u")return{exists:!1};try{const e=await u(()=>import("./vendor-B3hKfGQP.js").then(t=>t._),__vite__mapDeps([0,1])),a=(await u(()=>import("./vendor-B3hKfGQP.js").then(t=>t._),__vite__mapDeps([0,1]))).join(process.cwd(),"saily_plans.json"),r=await e.stat(a);return{exists:!0,lastModified:r.mtime,size:r.size}}catch{return{exists:!1}}}async updatePlansData(){if(typeof window<"u")return console.log("‚ö†Ô∏è Plan updates can only be run on server side"),!1;if(this.isUpdating)return console.log("‚è≥ Update already in progress, skipping..."),!1;this.isUpdating=!0;try{console.log("üöÄ Starting Saily plans data update using Python script...");const{spawn:e}=await u(async()=>{const{spawn:i}=await import("./vendor-B3hKfGQP.js").then(a=>a._);return{spawn:i}},__vite__mapDeps([0,1]));return new Promise(i=>{const a=e("python3",["scripts/fetch-saily-data.py"],{stdio:"pipe",cwd:process.cwd()});let r="",t="";a.stdout.on("data",o=>{const s=o.toString();r+=s,console.log(s.trim())}),a.stderr.on("data",o=>{const s=o.toString();t+=s,console.error(s.trim())}),a.on("close",async o=>{this.isUpdating=!1,o===0?(console.log("‚úÖ Python script completed successfully!"),i(!0)):(console.error(`‚ùå Python script failed with exit code ${o}`),i(!1))}),a.on("error",async o=>{this.isUpdating=!1,console.error("‚ùå Failed to run Python script:",o.message),i(!1)})})}catch(e){const i=e instanceof Error?e.message:"Unknown error";return console.error("‚ùå Failed to update Saily plans data:",i),!1}finally{this.isUpdating=!1}}async startWeeklyUpdates(){if(typeof window<"u"){console.log("‚ö†Ô∏è Weekly updates can only be scheduled on server side");return}try{const e=await u(()=>import("./vendor-B3hKfGQP.js").then(i=>i.n),__vite__mapDeps([0,1]));if(this.cronJob){console.log("‚ö†Ô∏è Weekly updates are already scheduled");return}this.cronJob=e.schedule("0 2 * * 0",async()=>{console.log("‚è∞ Weekly scheduled update triggered"),await this.updatePlansData()},{timezone:"UTC"}),this.cronJob.start(),console.log("üìÖ Weekly updates scheduled for every Sunday at 2:00 AM UTC")}catch(e){console.error("‚ùå Failed to schedule weekly updates:",e)}}stopWeeklyUpdates(){this.cronJob&&(this.cronJob.stop(),this.cronJob=null,console.log("‚èπÔ∏è Weekly updates stopped"))}clearCache(){}}const E=p.getInstance(),f={AT:"Europe",BE:"Europe",BG:"Europe",HR:"Europe",CY:"Europe",CZ:"Europe",DK:"Europe",EE:"Europe",FI:"Europe",FR:"Europe",DE:"Europe",GR:"Europe",HU:"Europe",IS:"Europe",IE:"Europe",IT:"Europe",LV:"Europe",LI:"Europe",LT:"Europe",LU:"Europe",MT:"Europe",NL:"Europe",NO:"Europe",PL:"Europe",PT:"Europe",RO:"Europe",SK:"Europe",SI:"Europe",ES:"Europe",SE:"Europe",CH:"Europe",GB:"Europe",UK:"Europe",VA:"Europe",AD:"Europe",MC:"Europe",SM:"Europe",ME:"Europe",RS:"Europe",BA:"Europe",MK:"Europe",AL:"Europe",MD:"Europe",UA:"Europe",BY:"Europe",RU:"Europe",CN:"Asia",JP:"Asia",KR:"Asia",IN:"Asia",TH:"Asia",VN:"Asia",SG:"Asia",MY:"Asia",ID:"Asia",PH:"Asia",TW:"Asia",HK:"Asia",MO:"Asia",KH:"Asia",LA:"Asia",MM:"Asia",BD:"Asia",LK:"Asia",NP:"Asia",BT:"Asia",MV:"Asia",AF:"Asia",PK:"Asia",UZ:"Asia",KZ:"Asia",KG:"Asia",TJ:"Asia",TM:"Asia",MN:"Asia",AM:"Asia",AZ:"Asia",GE:"Asia",TR:"Asia",IL:"Asia",PS:"Asia",JO:"Asia",LB:"Asia",SY:"Asia",IQ:"Asia",IR:"Asia",SA:"Asia",YE:"Asia",OM:"Asia",AE:"Asia",QA:"Asia",BH:"Asia",KW:"Asia",US:"North America",CA:"North America",MX:"North America",GT:"North America",BZ:"North America",SV:"North America",HN:"North America",NI:"North America",CR:"North America",PA:"North America",BR:"South America",AR:"South America",CL:"South America",PE:"South America",CO:"South America",VE:"South America",EC:"South America",BO:"South America",PY:"South America",UY:"South America",GY:"South America",SR:"South America",GF:"South America",ZA:"Africa",EG:"Africa",NG:"Africa",KE:"Africa",GH:"Africa",ET:"Africa",TZ:"Africa",UG:"Africa",MZ:"Africa",MG:"Africa",CM:"Africa",CI:"Africa",NE:"Africa",BF:"Africa",ML:"Africa",MW:"Africa",ZM:"Africa",SN:"Africa",SO:"Africa",TD:"Africa",GN:"Africa",RW:"Africa",BJ:"Africa",TN:"Africa",BI:"Africa",TG:"Africa",SL:"Africa",LY:"Africa",LR:"Africa",CF:"Africa",MR:"Africa",ER:"Africa",GM:"Africa",BW:"Africa",GA:"Africa",LS:"Africa",GW:"Africa",GQ:"Africa",MU:"Africa",SZ:"Africa",DJ:"Africa",KM:"Africa",CV:"Africa",ST:"Africa",SC:"Africa",MA:"Africa",DZ:"Africa",SD:"Africa",SS:"Africa",AO:"Africa",CD:"Africa",CG:"Africa",ZW:"Africa",NA:"Africa",AU:"Oceania",NZ:"Oceania",FJ:"Oceania",PG:"Oceania",NC:"Oceania",SB:"Oceania",VU:"Oceania",PF:"Oceania",WS:"Oceania",GU:"Oceania",TO:"Oceania",KI:"Oceania",PW:"Oceania",MH:"Oceania",FM:"Oceania",NR:"Oceania",TV:"Oceania",CK:"Oceania",NU:"Oceania",TK:"Oceania",WF:"Oceania",AS:"Oceania",MP:"Oceania"};class h{constructor(){this.cachedNormalizedPlans=null,this.lastCacheTime=0,this.CACHE_DURATION=300*1e3}static getInstance(){return h.instance||(h.instance=new h),h.instance}normalizeSailyPlan(e){const i=e.data_limit?.amount||0,a=e.data_limit?.unit||"GB",r=e.duration?.amount||0;let t="Global";if(e.covered_countries&&e.covered_countries.length>0)if(e.covered_countries.length===1)t=f[e.covered_countries[0]]||"Other";else if(e.covered_countries.length<=10){const g=e.covered_countries.map(l=>f[l]).filter(Boolean);if(g.length>0){const l={};g.forEach(A=>{l[A]=(l[A]||0)+1}),t=Object.keys(l).reduce((A,m)=>l[A]>l[m]?A:m)}}else t="Global";let o="country";return e.covered_countries&&e.covered_countries.length>10&&(o="regional"),e.covered_countries&&e.covered_countries.length>50&&(o="global"),{id:`saily-${e.covered_countries&&e.covered_countries.length===1?e.covered_countries[0].toLowerCase():"multi"}-${i}${a.toLowerCase()}-${r}d-${e.identifier.slice(-8)}`,identifier:e.identifier,name:e.name||`${i}${a} ${r} days`,data_amount:i,data_unit:a,data:`${i}${a}`,validity_days:r,validity:`${r} days`,price:{amount_with_tax:e.price?.amount_with_tax||0,currency:e.price?.currency||"USD",identifier:e.price?.identifier},covered_countries:e.covered_countries||[],region:t,planType:o,is_unlimited:e.is_unlimited||!1,source:"saily"}}async getNormalizedPlansData(){const e=Date.now();if(this.cachedNormalizedPlans&&e-this.lastCacheTime<this.CACHE_DURATION)return this.cachedNormalizedPlans;try{const{dataService:i}=await u(async()=>{const{dataService:s}=await import("./data-service-CydxH5Qr.js");return{dataService:s}},[]),a=await i.getPlansData(),r=await E.getCurrentPlansData(),t=[];a?.items&&a.items.forEach(s=>{t.push({...s,source:"local"})}),r?.items&&r.items.forEach(s=>{try{const c=this.normalizeSailyPlan(s);t.push(c)}catch(c){console.warn("Failed to normalize Saily plan:",s.identifier,c)}}),t.sort((s,c)=>{const g=s.covered_countries.length,l=c.covered_countries.length;return g===1&&l>1?-1:g>1&&l===1?1:s.price.amount_with_tax-c.price.amount_with_tax});const o={items:t};return this.cachedNormalizedPlans=o,this.lastCacheTime=e,console.log(`SailyPlansService: Normalized ${t.length} total plans (${a?.items?.length||0} local + ${r?.items?.length||0} Saily)`),o}catch(i){console.error("SailyPlansService: Failed to get normalized plans data:",i);try{const{dataService:a}=await u(async()=>{const{dataService:o}=await import("./data-service-CydxH5Qr.js");return{dataService:o}},[]),r=await a.getPlansData(),t=[];return r?.items&&r.items.forEach(o=>{t.push({...o,source:"local"})}),{items:t}}catch(a){return console.error("SailyPlansService: Fallback also failed:",a),{items:[]}}}}async getPlansForCountry(e){return(await this.getNormalizedPlansData()).items.filter(a=>a.covered_countries.includes(e.toUpperCase()))}async getPlansForRegion(e){const i=await this.getNormalizedPlansData(),r={europe:["Europe"],asia:["Asia"],"north-america":["North America"],"south-america":["South America"],africa:["Africa"],oceania:["Oceania"]}[e.toLowerCase()]||[e];return i.items.filter(t=>r.some(o=>t.region===o)||t.planType==="global"?!0:t.covered_countries&&t.covered_countries.length>0?t.covered_countries.some(o=>{const s=f[o];return r.includes(s)}):!1)}clearCache(){this.cachedNormalizedPlans=null,this.lastCacheTime=0}async getPlansStatistics(){const e=await this.getNormalizedPlansData(),i=e.items.filter(s=>s.source==="saily"),a=e.items.filter(s=>s.source==="local"),r=new Set;e.items.forEach(s=>{s.covered_countries.forEach(c=>r.add(c))});const t=e.items.reduce((s,c)=>s+c.price.amount_with_tax,0),o=e.items.length>0?t/e.items.length:0;return{totalPlans:e.items.length,sailyPlans:i.length,localPlans:a.length,countriesCovered:r.size,averagePrice:o/100}}}const I=h.getInstance(),L=(n,e="USD")=>e==="CNY"||e==="RMB"?`¬•${n.toFixed(2)}`:`$${n.toFixed(2)}`,R=()=>{const{i18n:n}=_();return{isChinese:n.language==="zh",currentLanguage:n.language}};export{d as B,P as a,S as b,v as c,O as d,M as e,L as f,b as g,C as h,N as i,T as j,D as k,I as s,R as u};
