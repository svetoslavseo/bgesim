import{jsx as r,jsxs as t}from"react/jsx-runtime";import{useState as f,useEffect as E}from"react";import{P}from"./components-0JP6n3jk.js";import{useTranslation as U}from"react-i18next";import{u as j,g as w,f as B}from"./utils-vRJ5uFnM.js";import{FiArrowRight as L}from"react-icons/fi";import"./constants-Ct2pKzgS.js";import"react-icons/fa";import"./articles-DvboirhH.js";import"./react-vendor-DuXzSgbK.js";import"react-fast-compare";import"invariant";import"shallowequal";import"i18next";import"i18next-browser-languagedetector";import"i18next-http-backend";import"react-icons/md";const S=()=>{const{t:o,i18n:d}=U(["checkout","countries"]),{isChinese:l}=j(),N=(e,n={})=>o(e,{ns:"countries",...n}),v=e=>{if(!e)return"";if(d.language==="bg"){if(e.includes("7 days"))return"7 дни";if(e.includes("15 days"))return"15 дни";if(e.includes("30 days"))return"30 дни";if(e.includes("1 day"))return"1 ден";if(e.includes("days"))return e.replace("days","дни");if(e.includes("day"))return e.replace("day","ден")}return e},[i,_]=f({country:"Austria",flag:"/esim-data/flags/at.svg",data:"1GB",validity:"7 days",price:3.99,currency:"$"}),[k,C]=f(!0),[h,c]=f(null),[G,g]=f(!1),u=e=>{if(console.log("getTranslatedName called with:",e),console.log("Current language:",d.language),console.log("i18n ready:",d.isInitialized),!d.isInitialized)return console.log("i18n not ready, returning original name"),e;const n={"North America":"north-america","South America":"south-america",Europe:"europe",Asia:"asia",Africa:"africa",Oceania:"oceania"};if(n[e]){try{const s=n[e],a=o(`regions.${s}`,{ns:"countries"});if(console.log("Region translation attempt:",{name:e,regionId:s,result:a}),a&&a!==`regions.${s}`)return a}catch(s){console.error("Region translation error:",s)}return e}try{const s=N(e.toLowerCase().replace(/\s+/g,"-"));return console.log("Country translation attempt:",{name:e,key:e.toLowerCase().replace(/\s+/g,"-"),result:s}),s===e.toLowerCase().replace(/\s+/g,"-")?(console.log("Country translation failed, using original name"),e):s}catch(s){return console.error("Translation error:",s),e}};E(()=>{(async()=>{const s=new URLSearchParams(window.location.search).get("plan");if(s)try{const a=JSON.parse(decodeURIComponent(s));if(a&&typeof a=="object"){if(typeof a.price=="object"&&a.price.amount_with_tax&&(a.price=a.price.amount_with_tax/100),console.log("DEBUG: decodedPlan in checkout:",a),console.log("DEBUG: decodedPlan.identifier:",a.identifier),console.log("DEBUG: decodedPlan.priceIdentifier:",a.priceIdentifier),!a.priceIdentifier&&a.identifier)try{const m=await fetch("/saily_plans.json");if(m.ok){const b=await m.json(),p=(Array.isArray(b?.items)?b.items:[]).find(I=>I?.identifier===a.identifier)?.price?.identifier;p?(console.log("DEBUG: Backfilled priceIdentifier from saily_plans.json:",p),a.priceIdentifier=p):console.warn("WARN: Could not backfill priceIdentifier for identifier:",a.identifier)}else console.warn("WARN: Failed to fetch saily_plans.json for backfill")}catch(m){console.error("Error backfilling priceIdentifier:",m)}_(a)}else c(o("errors.invalid_plan_data"))}catch(a){console.error("Error parsing plan data:",a),c(o("errors.unable_to_load_plan"))}else c(o("errors.no_plan_provided"));C(!1)})()},[]);const y=()=>{const e=i.priceIdentifier;if(!e){c(o("errors.no_plan_identifier"));return}try{console.log("DEBUG: plan in handleProceedToPayment:",i),console.log("DEBUG: plan.identifier (unused for checkout):",i.identifier),console.log("DEBUG: plan.priceIdentifier (used):",i.priceIdentifier),console.log("DEBUG: planIdForCheckout:",e);const n=l?`https://saily.com/zh/checkout/?planId=${e}&aff_transaction_id={transaction_id}&aff_offer_id={offer_id}&aff_id={aff_id}`:`https://saily.com/checkout/?planId=${e}&aff_transaction_id={transaction_id}&aff_offer_id={offer_id}&aff_id={aff_id}`,s=`https://go.saily.site/aff_c?offer_id=101&aff_id=8080&url=${encodeURIComponent(n)}`;console.log("DEBUG: sailyCheckoutUrl:",n),console.log("DEBUG: finalUrl:",s),window.location.href=s}catch(n){console.error("Error redirecting to payment:",n),c(o("errors.unable_to_proceed_payment"))}},x=(e,n)=>l?B(e,n):`${n}${e.toFixed(2)}`;return k?r("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center py-8 px-2",children:r("div",{className:"w-full max-w-xl bg-white rounded-2xl shadow-lg p-6 sm:p-10",children:t("div",{className:"text-center",children:[r("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),r("p",{className:"text-gray-600",children:o("loading.message")})]})})}):h?r("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center py-8 px-2",children:t("div",{className:"w-full max-w-xl bg-white rounded-2xl shadow-lg p-6 sm:p-10",children:[t("a",{href:l?"/zh":"/",className:"text-gray-500 text-sm mb-4 inline-block",children:["← ",o("navigation.back")]}),t("div",{className:"text-center",children:[r("div",{className:"text-red-600 mb-4",children:r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12 mx-auto",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"})})}),r("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:o("error.title")}),r("p",{className:"text-gray-600 mb-6",children:h}),r("a",{href:l?"/zh":"/",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:o("error.return_home")})]})]})}):t("div",{className:"min-h-screen bg-gray-50 py-8 pb-28 px-2",children:[t("div",{className:"w-full max-w-xl mx-auto",children:[t("a",{href:l?"/zh":"/",className:"text-gray-500 text-sm mb-4 inline-block",children:["← ",o("navigation.back")]}),t("div",{className:"bg-white rounded-2xl shadow-lg p-6 sm:p-10",children:[r("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:o("summary.title")}),t("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[t("div",{className:"flex items-center space-x-3 mb-3",children:[(()=>{const e=i.flag?.includes("/esim-data/flags/")?i.flag.split("/esim-data/flags/")[1]?.split(".")[0]?.toUpperCase():"GL",n=w(e,u(i.country),"w-12 h-12 rounded");return r("img",{...n,onError:()=>g(!0)})})(),r("h2",{className:"text-lg font-semibold text-gray-900",children:o("summary.esim_for",{country:u(i.country)})})]}),t("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t("div",{children:[t("span",{className:"text-gray-600",children:[o("summary.data"),":"]}),r("span",{className:"ml-2 font-medium",children:i.data})]}),t("div",{children:[t("span",{className:"text-gray-600",children:[o("summary.validity"),":"]}),r("span",{className:"ml-2 font-medium",children:v(i.validity)})]})]}),r("div",{className:"mt-4 pt-4 border-t border-gray-200",children:t("div",{className:"flex justify-between items-center",children:[t("span",{className:"text-lg font-semibold text-gray-900",children:[o("summary.total"),":"]}),r("span",{className:"text-2xl font-bold text-blue-600",children:x(i.price,i.currency)})]})})]}),t("div",{className:"mb-6",children:[r("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:o("payment.methods.title")}),r(P,{})]}),r("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:t("div",{className:"flex items-center space-x-2",children:[r("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),r("span",{className:"text-sm text-blue-800",children:o("security.ssl_encrypted")})]})}),r("button",{onClick:y,className:"hidden",children:o("payment.continue")})]})]}),r("div",{className:"fixed inset-x-0 bottom-0 z-40 border-t border-gray-200 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/80",children:t("div",{className:"max-w-xl mx-auto px-4 py-3",children:[t("div",{className:"flex items-center justify-between text-sm mb-2",children:[t("div",{className:"flex items-center space-x-2",children:[(()=>{const e=i.flag?.includes("/esim-data/flags/")?i.flag.split("/esim-data/flags/")[1]?.split(".")[0]?.toUpperCase():"GL",n=w(e,u(i.country),"w-7 h-7 rounded");return r("img",{...n,onError:()=>g(!0)})})(),t("span",{className:"text-gray-600",children:[o("summary.total"),":"]})]}),r("span",{className:"font-bold text-gray-900",children:x(i.price,i.currency)})]}),t("button",{onClick:y,className:"group relative w-full bg-gradient-to-r from-yellow-400 via-yellow-300 to-yellow-400 text-black py-4 px-6 pr-12 rounded-xl font-bold hover:from-yellow-300 hover:via-yellow-200 hover:to-yellow-300 transform hover:scale-[1.02] transition-all duration-200 focus:outline-none focus:ring-3 focus:ring-yellow-500 focus:ring-offset-2 text-center shadow-lg hover:shadow-xl border-2 border-yellow-500/30",children:[r("span",{className:"pointer-events-none text-lg font-extrabold",children:o("payment.continue")}),r(L,{className:"absolute right-5 top-1/2 -translate-y-1/2 transform transition-all duration-200 group-hover:translate-x-1 group-hover:scale-110 text-black",size:22})]})]})})]})};export{S as default};
